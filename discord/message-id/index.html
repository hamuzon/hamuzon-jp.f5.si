<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Discord Snowflake Analyzer & Info</title>

<!-- Favicon -->
<link rel="icon" href="https://hamusata.f5.si/icon.webp" type="image/webp" />

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet" />

<style>
:root{
  --bg-a:#071024; --bg-b:#071842;
  --accent-1:#00B8D4; --accent-2:#7C3AED;
  --text-main:#EAF6FF; --muted:rgba(234,246,255,0.75);
  --max-width:600px;
}
*,*::before,*::after{box-sizing:border-box;}
html,body{height:100%;margin:0;}
body{
  font-family:"Inter","Noto Sans JP",system-ui;
  background: radial-gradient(1200px 600px at 10% 10%, rgba(12,36,72,0.6), transparent 10%), linear-gradient(135deg,var(--bg-a),var(--bg-b) 60%);
  display:flex; flex-direction:column; align-items:center; padding:16px; color:var(--text-main);
}
.container{
  width:100%; max-width:var(--max-width); padding:20px; border-radius:18px; background: rgba(255,255,255,0.03); backdrop-filter:blur(12px); margin-bottom:16px;
}
h1{margin:0 0 16px 0; font-weight:800; font-size:1.6rem; text-align:center; color:var(--text-main);}
.controls{display:flex; gap:10px; margin-bottom:12px;}
input{flex:1; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.02); color:var(--text-main); font-family: monospace;}
button{padding:10px 16px; border:none; border-radius:10px; background: linear-gradient(90deg,var(--accent-1),var(--accent-2)); color:#02131A; cursor:pointer; font-weight:700;}
button:hover{filter:brightness(1.05);}
.result{padding:12px; border-radius:12px; background: rgba(0,0,0,0.02); font-family: monospace; font-size:0.95rem; white-space:pre-wrap;}
.explain{padding:12px; border-radius:12px; background: rgba(0,0,0,0.04); font-size:0.9rem; margin-top:12px; line-height:1.4; color:var(--muted);}
.explain a{color:var(--accent-1); text-decoration:underline;}
@media(max-width:600px){.controls{flex-direction:column;} button{width:100%;}}
</style>
</head>
<body>

<div class="container">
<h1>Discord Snowflake Analyzer</h1>
<div class="controls">
<input type="text" id="snowflakeInput" placeholder="DiscordメッセージIDを入力" oninput="analyze()" />
<button onclick="analyze()">解析</button>
</div>
<div id="result" class="result"></div>
</div>

<div class="container explain">
<h2>Snowflake IDの仕組みと公式情報</h2>
<p>DiscordのSnowflake IDは64bit整数で構成されます。<br>
公式ドキュメントも参照可能です：
<a href="https://discord.com/developers/docs/reference#snowflakes" target="_blank">Discord Snowflake公式ドキュメント</a></p>
<ul>
<li><strong>0〜41ビット:</strong> Discord Epochからのミリ秒（生成日時）</li>
<li><strong>42〜51ビット:</strong> Worker ID（どのサーバープロセスで生成されたか）</li>
<li><strong>52〜63ビット:</strong> Sequence（同じミリ秒内での連番）</li>
</ul>
<p>Snowflake IDは単純な数字ではなく、<strong>日時順に増加</strong>する仕組みです。<br>
Binary/Hexで見るとIDの内部構造がわかります。</p>
</div>

<script>
function formatDate(date, locale='ja-JP', timeZone='Asia/Tokyo') {
  return new Intl.DateTimeFormat(locale,{
    year:'numeric', month:'2-digit', day:'2-digit',
    hour:'2-digit', minute:'2-digit', second:'2-digit',
    fractionalSecondDigits:3,
    hour12:false,
    timeZone
  }).format(date);
}

function analyze(){
  let input = document.getElementById('snowflakeInput').value;
  const result = document.getElementById('result');
  if(!input){ result.innerText=''; return; }

  input = input.replace(/[\s\u3000]/g,''); // 空白・全角スペース除去
  if(!/^\d+$/.test(input)){ result.innerText='⚠️ 数字のみのIDを入力してください。'; return; }

  try{
    const id = BigInt(input);
    const discordEpoch = 1420070400000n;
    const timestampMsBigInt = (id >> 22n) + discordEpoch;

    let date;
    if(timestampMsBigInt <= BigInt(Number.MAX_SAFE_INTEGER)){
      date = new Date(Number(timestampMsBigInt));
    } else {
      date = new Date(Number(discordEpoch + (id >> 22n & 0x1FFFFFn)));
    }

    const utc = formatDate(date,'en-US','UTC');
    const jst = formatDate(date,'ja-JP','Asia/Tokyo');
    const elapsedMs = timestampMsBigInt - discordEpoch;

    const workerId = (id >> 12n) & 0x3FFn;
    const sequence = id & 0xFFFn;
    const binary = id.toString(2).padStart(64,'0');
    const hex = '0x'+id.toString(16).toUpperCase();

    result.innerText = `
Snowflake ID: ${input}

作成日時:
  UTC: ${utc}
  JST: ${jst}
  Discord Epochから経過(ms): ${elapsedMs.toString()}

Worker ID (10bit): ${workerId}
Sequence (12bit): ${sequence}

Binary (64bit): ${binary}
Hexadecimal: ${hex}
BigInt値: ${id}

順序性目安: 数値が大きいほど新しいID
`.trim();

  } catch(e){
    result.innerText='⚠️ 無効なIDです。';
  }
}
</script>

</body>
</html>