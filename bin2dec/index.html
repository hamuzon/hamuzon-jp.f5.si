<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="2進数 ⇔ 10進数 変換ツール 相互の変換ができます 符号付き対応" />
    <title>2進数 ⇔ 10進数 変換ツール</title>

    <script>
        (function() {
            const saved = localStorage.getItem('tool_theme') || 'system';
            let target = saved;
            if (saved === 'system') {
                target = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            }
            document.documentElement.className = target;
        })();
    </script>

    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@700;900&family=Roboto+Mono:wght@500&display=swap" rel="stylesheet" />

    <style>
        :root {
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        *, *::before, *::after {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }

        html, body {
            overscroll-behavior-y: auto;
        }

        html.light {
            --primary: #78a9cc;
            --primary-text: #ffffff;
            --text: #5a6d7d;
            --card: #ffffff;
            --bg: #ebf1f5;
            --input-bg: #f5f9fc;
            --border: #cedde8;
            --shadow: rgba(120, 169, 204, 0.15);
            --link: #5c93bb;
            background: var(--bg);
            color-scheme: light;
        }

        html.dark {
            --primary: #5c93bb;
            --primary-text: #e0f0fa;
            --text: #b0c4d1;
            --card: #1e2630;
            --bg: #12181f;
            --input-bg: #12181f;
            --border: #323f4d;
            --shadow: rgba(0, 0, 0, 0.5);
            --link: #88b4d4;
            background: var(--bg);
            color-scheme: dark;
        }

        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            margin: 0;
            padding: 20px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: var(--text);
            line-height: 1.6;
        }

        header {
            text-align: center;
            margin-bottom: 25px;
        }

        h1 {
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--primary);
            margin: 10px 0;
            letter-spacing: 0.05em;
        }

        .mode-select-container {
            display: flex;
            justify-content: center;
            margin-bottom: 25px;
        }

        select {
            padding: 12px 20px;
            border-radius: 50px;
            border: 2px solid var(--border);
            background: var(--card);
            color: var(--text);
            font-weight: 700;
            font-family: inherit;
            cursor: pointer;
            box-shadow: 0 4px 12px var(--shadow);
            transition: var(--transition);
            appearance: none;
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 10px;
            padding-right: 45px;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg width='14' height='8' viewBox='0 0 14 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L7 7L13 1' stroke='%2378a9cc' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
        }

        .tab-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-nav button {
            flex: 1;
            padding: 15px 10px;
            border-radius: 20px;
            border: 2px solid var(--border);
            background: var(--card);
            color: var(--text);
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 5px 0 var(--border);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .tab-nav button.active {
            background: var(--primary);
            color: var(--primary-text);
            border-color: var(--primary);
            box-shadow: 0 0px 0 var(--primary);
            transform: translateY(5px);
        }

        main {
            background: var(--card);
            border-radius: 35px;
            padding: 30px 20px;
            border: 1px solid var(--border);
            box-shadow: 0 20px 40px var(--shadow);
        }

        .input-section {
            margin-bottom: 30px;
        }

        .label-box {
            text-align: center;
            margin-bottom: 12px;
        }

        .label-main {
            font-weight: 900;
            font-size: 1.1rem;
            color: var(--primary);
            display: block;
        }

        .label-sub {
            font-size: 0.7rem;
            opacity: 0.6;
            text-transform: uppercase;
        }

        input {
            width: 100%;
            padding: 20px;
            font-size: 1.8rem;
            border-radius: 25px;
            border: 3px solid var(--border);
            background: var(--input-bg);
            color: var(--text);
            font-family: 'Roboto Mono', monospace;
            text-align: center;
            transition: var(--transition);
        }

        input:focus {
            border-color: var(--primary);
            background: var(--card);
            box-shadow: 0 0 0 8px var(--shadow);
        }

        .result-section {
            background: var(--bg);
            border-radius: 30px;
            border: 2px dashed var(--border);
            padding: 25px 15px;
            text-align: center;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .result-value {
            font-size: 2rem;
            font-weight: 900;
            color: var(--primary);
            word-break: break-all;
            overflow-y: auto;
            max-height: 180px;
            padding: 5px;
        }

        footer {
            margin-top: auto;
            padding: 25px 0;
            text-align: center;
        }

        .footer-copy {
            font-weight: 700;
            font-size: 0.75rem;
            letter-spacing: 0.02em;
            color: var(--text);
            opacity: 0.9;
        }

        a {
            color: var(--link);
            text-decoration: none;
        }

        @media (max-width: 380px) {
            h1 { font-size: 1.2rem; }
            input { font-size: 1.5rem; }
            .result-value { font-size: 1.6rem; }
        }
    </style>
</head>
<body>

    <header>
        <h1>2進数 ⇔ 10進数</h1>
    </header>

    <div class="mode-select-container">
        <select id="themeSelect">
            <option value="light">ライト / Light Mode</option>
            <option value="dark">ダーク / Dark Mode</option>
            <option value="system" selected>端末の設定 / Device Settings</option>
        </select>
    </div>

    <nav class="tab-nav">
        <button id="tabBin" class="active">
            <div>2進数 → 10進数</div>
            <div>Binary to Decimal</div>
        </button>

        <button id="tabDec">
            <div>10進数 → 2進数</div>
            <div>Decimal to Binary</div>
        </button>
    </nav>

    <main>
        <div id="panelBin">
            <div class="input-section">
                <div class="label-box">
                    <span class="label-main">2進数</span>
                    <span class="label-sub">Binary (Base 2)</span>
                </div>
                <input type="text" id="inBin" placeholder="0000" inputmode="numeric" autocomplete="off" />
            </div>

            <div class="result-section">
                <div class="result-label">
                    <span class="label-main" style="font-size: 0.85rem; opacity: 0.8;">10進数の結果</span>
                    <span class="label-sub">Decimal Result</span>
                </div>
                <div id="outBin" class="result-value">-</div>
            </div>
        </div>

        <div id="panelDec" style="display:none;">
            <div class="input-section">
                <div class="label-box">
                    <span class="label-main">10進数</span>
                    <span class="label-sub">Decimal (Base 10)</span>
                </div>
                <input type="text" id="inDec" placeholder="0" inputmode="numeric" autocomplete="off" />
            </div>

            <div class="result-section">
                <div class="result-label">
                    <span class="label-main" style="font-size: 0.85rem; opacity: 0.8;">2進数の結果</span>
                    <span class="label-sub">Binary Result</span>
                </div>
                <div id="outDec" class="result-value">-</div>
            </div>
        </div>
    </main>

    <footer>
        <div id="footer-copy" class="footer-copy">
            &copy; 2025 Binary &harr; Decimal Converter
        </div>
    </footer>

    <script>
        const inBin = document.getElementById('inBin');
        const inDec = document.getElementById('inDec');
        const outBin = document.getElementById('outBin');
        const outDec = document.getElementById('outDec');
        const themeSelect = document.getElementById('themeSelect');

        const updateBinToDec = () => {
            let val = inBin.value.replace(/[^01-]/g, '');
            if (val.indexOf('-') > 0) val = val.replace(/-/g, '');
            inBin.value = val;

            if (!val || val === '-') {
                outBin.innerText = '-';
                return;
            }

            let dec = parseInt(val, 2);
            if (val[0] === '1' && val.length > 1) dec -= Math.pow(2, val.length);
            outBin.innerText = dec;
        };

        const updateDecToBin = () => {
            let val = inDec.value.replace(/[^0-9-]/g, '');
            if (val.indexOf('-') > 0) val = val.replace(/-/g, '');
            inDec.value = val;

            const num = parseInt(val, 10);
            if (isNaN(num)) {
                outDec.innerText = '-';
                return;
            }

            if (num >= 0) {
                outDec.innerText = '0' + num.toString(2);
            } else {
                const bits = Math.max(num.toString(2).length, 2);
                outDec.innerText = (num >>> 0).toString(2).slice(-bits);
            }
        };

        const formatBinaryWithPadding = (number, minLength) => {
            let binStr = "";
            if (number >= 0) {
                binStr = "0" + number.toString(2);
            } else {
                const bits = Math.max(number.toString(2).length, 2);
                binStr = (number >>> 0).toString(2).slice(-bits);
            }

            if (binStr.length < minLength) {
                const padChar = binStr[0] === '1' ? '1' : '0';
                return binStr.padStart(minLength, padChar);
            }
            return binStr;
        };

        const handleStep = (e, type) => {
            if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {
                e.preventDefault();
                if (type === 'bin') {
                    const currentLen = inBin.value.length;
                    let curDec = parseInt(outBin.innerText, 10) || 0;
                    const nextDec = e.key === 'ArrowUp' ? curDec + 1 : curDec - 1;
                    inBin.value = formatBinaryWithPadding(nextDec, currentLen);
                    updateBinToDec();
                } else {
                    let curDec = parseInt(inDec.value, 10) || 0;
                    inDec.value = e.key === 'ArrowUp' ? curDec + 1 : curDec - 1;
                    updateDecToBin();
                }
            }
        };

        inBin.oninput = updateBinToDec;
        inDec.oninput = updateDecToBin;
        inBin.onkeydown = (e) => handleStep(e, 'bin');
        inDec.onkeydown = (e) => handleStep(e, 'dec');

        const switchTab = (isBin) => {
            document.getElementById('panelBin').style.display = isBin ? 'block' : 'none';
            document.getElementById('panelDec').style.display = isBin ? 'none' : 'block';
            document.getElementById('tabBin').className = isBin ? 'active' : '';
            document.getElementById('tabDec').className = isBin ? '' : 'active';
        };

        document.getElementById('tabBin').onclick = () => switchTab(true);
        document.getElementById('tabDec').onclick = () => switchTab(false);

        const applyTheme = (mode) => {
            let target = mode;
            if (mode === 'system') {
                target = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            }
            document.documentElement.className = target;
        };

        themeSelect.onchange = (e) => {
            localStorage.setItem('tool_theme', e.target.value);
            applyTheme(e.target.value);
        };

        window.onload = () => {
            const baseYear = 2025;
            const currentYear = new Date().getFullYear();
            const hostname = location.hostname;
            const footer = document.getElementById("footer-copy");

            let copyrightYear = currentYear > baseYear ? `${baseYear}~${currentYear}` : `${baseYear}`;
            let footerHTML = `&copy; ${copyrightYear} `;

            if (hostname.includes("hamuzon-jp.f5.si") || hostname.includes("hamuzon.web.fc2.com") || hostname.includes("hamuzon.github.io")) {
                footerHTML += `<a href="#" target="_blank">@hamuzon</a>`;
            } else if (hostname.includes("hamusata.f5.si")) {
                footerHTML += `<a href="#" target="_blank">@hamusata</a>`;
            } else {
                footerHTML += `Binary &harr; Decimal Converter`;
            }

            if (footer) footer.innerHTML = footerHTML;

            const saved = localStorage.getItem('tool_theme') || 'system';
            themeSelect.value = saved;
            applyTheme(saved);
        };

        window.matchMedia('(prefers-color-scheme: dark)').onchange = () => {
            if (themeSelect.value === 'system') applyTheme('system');
        };
    </script>
</body>
</html>
