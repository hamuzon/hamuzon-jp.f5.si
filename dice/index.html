<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>dice</title>

    <link rel="icon" href="/favicon.ico" type="image/x-icon" />

    <style>
        *, *::before, *::after {
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #FFE29F 0%, #FFA99F 100%);
            color: #5B3A00;
            margin: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        main {
            background: #fff8e1;
            padding: 2rem 2.5rem;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(255, 160, 160, 0.3);
            max-width: 400px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            text-align: center;
            margin: 0 0 1rem 0;
            font-weight: 700;
            color: #d35d00;
        }

        label {
            display: block;
            margin-top: 1rem;
            font-weight: 600;
            color: #7f4a00;
            width: 100%;
        }

        input[type=number] {
            width: 100%;
            padding: 0.5rem 0.7rem;
            font-size: 1rem;
            border-radius: 8px;
            border: 1.5px solid #d97400;
            margin-top: 0.3rem;
            transition: border-color 0.3s ease;
        }

        input[type=number]:focus {
            outline: none;
            border-color: #ffa94d;
            box-shadow: 0 0 5px #ffa94d;
        }

        button {
            margin-top: 1.8rem;
            width: 100%;
            padding: 0.75rem;
            font-size: 1.1rem;
            font-weight: 700;
            border: none;
            border-radius: 12px;
            background: linear-gradient(45deg, #ffb347, #ffcc33);
            color: #5b3a00;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(255, 204, 51, 0.6);
            transition: background 0.3s ease;
        }

        button:hover:not(:disabled) {
            background: linear-gradient(45deg, #ffcc33, #ffb347);
        }

        button:active:not(:disabled) {
            transform: scale(0.98);
        }

        button:disabled {
            background: #ddd;
            color: #999;
            cursor: not-allowed;
            box-shadow: none;
        }

        #result {
            margin-top: 2rem;
            padding: 1rem;
            background: #fff3cd;
            border: 1px solid #ffecb5;
            border-radius: 12px;
            font-size: 1.1rem;
            color: #5b3a00;
            min-height: 3rem;
            white-space: pre-wrap;
            width: 100%;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            justify-content: center;
        }

        .details {
            font-size: 0.9rem;
            color: #7f4a00;
        }

        .timestamp {
            font-size: 0.8rem;
            color: #a18a68;
            margin-top: 0.3rem;
        }

        #footer-copy {
            margin-top: 1rem;
            color: #5b3a00;
            font-size: 0.9rem;
            text-align: center;
            -webkit-user-select: none;
            user-select: none;
            width: 100%;
        }

        @media (max-width: 480px) {
            main {
                padding: 1.5rem 1.8rem;
                max-width: 320px;
            }
            button {
                font-size: 1rem;
                padding: 0.6rem;
            }
        }
    </style>
</head>
<body>
    <main>
        <h1>da-ice üé≤</h1>

        <label for="sides">Èù¢Êï∞ (2„Äú1000):</label>
        <input type="number" id="sides" value="6" min="2" max="1000" />

        <label for="count">ÂÄãÊï∞ (1„Äú20):</label>
        <input type="number" id="count" value="1" min="1" max="20" />

        <button id="rollBtn">„Çµ„Ç§„Ç≥„É≠„ÇíÊåØ„ÇãÔºÅ</button>

        <div id="result" role="region" aria-live="polite"></div>

        <div id="footer-copy">&copy; 2025 „Çµ„Ç§„Ç≥„É≠„Ç¢„Éó„É™ / dice app</div>
    </main>

    <script>
        const apiCandidates = [
            "https://api.hamusata.f5.si/api/dice",
            "https://dice-api.hamusata.f5.si/api/dice"
        ];

        const rollBtn = document.getElementById('rollBtn');
        const resultDiv = document.getElementById('result');
        let canRoll = true;

        function clampAndSet(id, value, min, max) {
            const clamped = Math.min(Math.max(value, min), max);
            const input = document.getElementById(id);
            if (input.value != clamped) input.value = clamped;
            return clamped;
        }

        async function fetchFromApis(urls) {
            for (const url of urls) {
                try {
                    const res = await fetch(url);
                    if (!res.ok) throw new Error();
                    return await res.json();
                } catch (error) {
                    continue;
                }
            }
            throw new Error("„Åô„Åπ„Å¶„ÅÆAPI„ÅåÂøúÁ≠î„Åó„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ");
        }

        rollBtn.addEventListener('click', async () => {
            if (!canRoll) return;

            canRoll = false;
            rollBtn.disabled = true;
            resultDiv.textContent = 'Âá¶ÁêÜ‰∏≠„Åß„Åô„ÄÇ„Åó„Å∞„Çâ„Åè„ÅäÂæÖ„Å°„Åè„Å†„Åï„ÅÑ„ÄÇ';

            const sides = clampAndSet('sides', Number(document.getElementById('sides').value), 2, 1000);
            const count = clampAndSet('count', Number(document.getElementById('count').value), 1, 20);

            const query = `?sides=${sides}&count=${count}`;
            const urlsWithParams = apiCandidates.map(base => base + query);

            try {
                const data = await fetchFromApis(urlsWithParams);
                
                let html = "";
                
                // „É°„Ç§„É≥„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫
                if (data.message) {
                    html += `<div>${data.message}</div>`;
                }
                
                // „Çµ„Ç§„Ç≥„É≠„Åå2ÂÄã‰ª•‰∏ä„ÅÆÊôÇ„Å†„ÅëÂá∫ÁõÆ„Çí‰∏¶„Åπ„Å¶Ë°®Á§∫
                if (data.rolls && data.rolls.length > 1) {
                    html += `<div class="details">${data.rolls.join(', ')}</div>`;
                }
                
                // ÊôÇÂàª„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„ÅøË°®Á§∫
                if (data.timestamp_jst) {
                    html += `<div class="timestamp">${data.timestamp_jst}</div>`;
                }

                resultDiv.innerHTML = html || "ÁµêÊûú„ÅåÁ©∫„Åß„Åó„Åü";
                
            } catch (error) {
                resultDiv.textContent = '„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ' + error.message;
            } finally {
                setTimeout(() => {
                    canRoll = true;
                    rollBtn.disabled = false;
                }, 5000);
            }
        });
        
        
        
        (function() {
            const baseYear = 2025;
            const currentYear = new Date().getFullYear();
            const hostname = location.hostname;
            const footer = document.getElementById("footer-copy");
    
            let copyrightYear = baseYear + (currentYear > baseYear ? "~" + currentYear : "");
            let footerHTML = `&copy; ${copyrightYear} `;
    
            if (hostname.includes("hamuzon-jp.f5.si")) {
                footerHTML += `<a href="https://hamuzon-jp.f5.si" target="_blank">@hamuzon</a>`;
            } else if (hostname.includes("hamuzon.web.fc2.com")) {
                footerHTML += `<a href="https://hamuzon.web.fc2.com" target="_blank">@hamuzon</a>`;
            } else if (hostname.includes("hamuzon.github.io")) {
                footerHTML += `<a href="https://hamuzon.github.io" target="_blank">@hamuzon</a>`;
            } else if (hostname.includes("hamusata.f5.si")) {
                footerHTML += `<a href="https://hamusata.f5.si" target="_blank">@hamusata</a>`;
            } else {
                footerHTML += `„Çµ„Ç§„Ç≥„É≠„Ç¢„Éó„É™ / dice app`;
        }
            if (footer) footer.innerHTML = footerHTML;
        })();
    </script>
</body>
</html>
