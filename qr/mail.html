<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>ãƒ¡ãƒ¼ãƒ«QRã‚³ãƒ¼ãƒ‰ãƒ„ãƒ¼ãƒ« â€“ Mail QR Code Tool</title>

<link rel="icon" href="icon.svg" type="image/svg+xml">

<style>
:root {
  --color-accent: #3399ff;
  --color-accent-light: #7fbfff;
  --bg-gradient: linear-gradient(
    180deg,
    #fde2e2 0%,
    #fff1e6 30%,
    #d0e7f9 70%,
    #a8d0e6 100%
  );
  --link-color: #28a745;
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  min-height: 100vh;
  padding: 2rem;
  display: flex;
  justify-content: center;
  align-items: center;
  background: var(--bg-gradient);
  font-family: 'Inter','Segoe UI','Hiragino Kaku Gothic ProN',Arial,sans-serif;
  color: #333;
}

main.container {
  width: 100%;
  max-width: 520px;
  padding: 2rem;
  background: rgba(255,255,255,0.85);
  backdrop-filter: blur(10px);
  border-radius: 1.5rem;
  box-shadow: 0 8px 24px rgba(0,0,0,0.1);
  display: flex;
  flex-direction: column;
  text-align: center;
}

h1 {
  font-size: 2.2rem;
  margin-bottom: 1.5rem;
}

input,
textarea {
  width: 100%;
  padding: 0.8rem;
  font-size: 1.1rem;
  border-radius: 14px;
  border: 1.5px solid var(--color-accent);
  box-shadow: 0 6px 12px rgba(51,153,255,0.15);
  outline: none;
  margin-bottom: 1rem;
}

textarea {
  resize: vertical;
}

input:focus,
textarea:focus {
  background-color: #f0f8ff;
  border-color: #1673e6;
}

.actions {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

button.action {
  flex: 1;
  padding: 0.85rem;
  font-size: 1.15rem;
  font-weight: bold;
  border: none;
  border-radius: 14px;
  background-color: var(--color-accent);
  color: #fff;
  cursor: pointer;
  box-shadow: 0 6px 15px rgba(51,153,255,0.7);
  transition: background-color 0.3s;
}

button.action:hover {
  background-color: #1673e6;
}

#downloadBtn,
#shareBtn {
  display: none;
}

#qrcode {
  margin-top: 2rem;
  display: flex;
  justify-content: center;
}

footer {
  margin-top: 2.5rem;
  font-size: 0.85rem;
  line-height: 1.5;
  color: inherit;
  display: flex;
  flex-direction: column;
  align-items: center;
}

footer a {
  color: var(--link-color);
  text-decoration: none;
}

footer a:hover {
  text-decoration: underline;
}

@media (max-width: 480px) {
  .actions {
    flex-direction: column;
  }
}
</style>
</head>

<body>

<main class="container">

<h1>ğŸ“§ ãƒ¡ãƒ¼ãƒ«QRã‚³ãƒ¼ãƒ‰ä½œæˆ</h1>

<input
  type="text"
  id="mailTo"
  placeholder="å®›å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"
  autocomplete="off"
>

<input
  type="text"
  id="mailSubject"
  placeholder="ä»¶å"
>

<textarea
  id="mailBody"
  rows="4"
  placeholder="æœ¬æ–‡"
></textarea>

<div class="actions">
  <button class="action" onclick="generateQR()">QRä½œæˆ</button>
  <button class="action" id="downloadBtn" onclick="downloadQR()">QRä¿å­˜</button>
  <button class="action" id="shareBtn" onclick="shareURL()">URLå…±æœ‰</button>
</div>

<div id="qrcode"></div>

<footer id="footer-copy">
  <p>
    ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã¯
    <a href="https://github.com/soldair/node-qrcode" target="_blank" rel="noopener noreferrer">
      QRCode.js
    </a>
    ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚
  </p>
  <p>
    æœ¬ãƒ„ãƒ¼ãƒ«ã§ç”Ÿæˆã—ãŸQRã‚³ãƒ¼ãƒ‰ã®åˆ©ç”¨ã«ã‚ˆã£ã¦ç”Ÿã˜ãŸã„ã‹ãªã‚‹æå®³ã‚„ãƒˆãƒ©ãƒ–ãƒ«ã«ã¤ã„ã¦ã‚‚ã€
    å½“æ–¹ã¯ä¸€åˆ‡è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚
  </p>
</footer>

</main>

<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>

<script>
function generateQR(auto = false) {

  const to = document.getElementById('mailTo').value.trim()
  const subject = encodeURIComponent(document.getElementById('mailSubject').value.trim())
  const body = encodeURIComponent(document.getElementById('mailBody').value.trim())

  if (!to) {
    if (!auto) alert('å®›å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„')
    return
  }

  const data = `mailto:${to}?subject=${subject}&body=${body}`

  const qr = document.getElementById('qrcode')
  qr.innerHTML = ''

  QRCode.toCanvas(data, { width: 256 }, (err, canvas) => {
    if (err) return alert('QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ')

    qr.appendChild(canvas)
    downloadBtn.style.display = 'inline-block'
    shareBtn.style.display = 'inline-block'
  })
}

function downloadQR() {

  const canvas = document.querySelector('#qrcode canvas')
  if (!canvas) return

  const now = new Date()
  const name =
    'MAIL_QR_' +
    now.getFullYear() +
    String(now.getMonth() + 1).padStart(2, '0') +
    String(now.getDate()).padStart(2, '0') +
    '_' +
    String(now.getHours()).padStart(2, '0') +
    String(now.getMinutes()).padStart(2, '0') +
    '.png'

  const a = document.createElement('a')
  a.download = name
  a.href = canvas.toDataURL('image/png')
  a.click()
}

function shareURL() {

  const params = new URLSearchParams({
    to: mailTo.value,
    subject: mailSubject.value,
    body: mailBody.value
  })

  const url = location.origin + location.pathname + '?' + params.toString()

  navigator.clipboard.writeText(url).then(() => {
    alert('URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ')
  })
}

const params = new URLSearchParams(location.search)

if (params.has('to')) {
  mailTo.value = params.get('to') || ''
  mailSubject.value = params.get('subject') || ''
  mailBody.value = params.get('body') || ''
  generateQR(true)
}

(() => {
  const footer = document.getElementById("footer-copy");
  if (!footer) {
    return;
  }

  const baseYear = 2025;
  const currentYear = new Date().getFullYear();
  const hostname = location.hostname;
  const yearString = `${baseYear}${currentYear > baseYear ? "â€“" + currentYear : ""}`;
  let footerHTML = "";

  if (hostname === "hamuzon.github.io") {
    footerHTML = `&copy; ${yearString} <a class="link" href="https://hamuzon.github.io" target="_blank" rel="noopener noreferrer">@hamuzon</a>`;
  } else if (hostname.includes("hamuzon-jp.f5.si")) {
    footerHTML = `&copy; ${yearString} <a class="link" href="https://hamuzon-jp.f5.si" target="_blank" rel="noopener noreferrer">@hamuzon</a>`;
  } else if (hostname.includes("hamusata.f5.si")) {
    footerHTML = `&copy; ${yearString} <a class="link" href="https://hamusata.f5.si" target="_blank" rel="noopener noreferrer">@hamusata</a>`;
  } else if (hostname.includes("qr.link-s.f5.si")) {
    footerHTML = `&copy; ${yearString} <a class="link" href="https://hamusata.f5.si" target="_blank" rel="noopener noreferrer">@hamusata</a>`;
  } else if (hostname.includes("hamusata.f5.si")) {
    footerHTML = `&copy; ${yearString} <a class="link" href="https://hamusata.f5.si" target="_blank" rel="noopener noreferrer">@hamusata</a>`;
  } else {
    footerHTML = `&copy; ${yearString} Mail QR Code Tool`;
  }

  const copyrightElement = document.createElement("div");
  copyrightElement.innerHTML = footerHTML;
  footer.prepend(copyrightElement);
})()
</script>

</body>
</html>